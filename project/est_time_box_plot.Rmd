---
title: "est_time_box_plot.rmd"
output: html_notebook
---

```{r}
library(tidyverse)
library(reshape2)
library(lubridate)

days_of_week <- c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")
```

```{r}
head(rides_df)
```


```{r}
for (i in 1:14) {
  mean <- rides[[i]] %>%
    summarise(mean = mean(SPOSTMIN, na.rm=T)) %>%
    round(digits = 2)
  print(paste("The average wait time for ", names(rides[i]), " is ", mean, sep = ""))
}
```


```{r}
for (i in 1:14) {
  mean <- rides[[i]] %>%
    summarise(mean = mean(SACTMIN, na.rm=T)) %>%
    round(digits = 2)
  print(paste("The real average wait time for ", names(rides[i]), " is ", mean, sep = ""))
}
```


```{r}
rides_df %>%
  filter(datetime > as.POSIXct("2018-06-30")) %>%
  ggplot(aes(x = SPOSTMIN, y = ride_name)) +
  geom_boxplot(na.rm = TRUE, outlier.shape = "circle", outlier.alpha = .1, size = 1) + 
  coord_cartesian(xlim = c(0,275)) +
  geom_vline(xintercept = c(30, 60, 90, 120), color = c("green", "yellow", "orange", "red"), size = 1)
```


```{r}
rides_df %>% group_by(ride_name) %>%
  filter(datetime > as.POSIXct("2018-06-30")) %>%
  ggplot(aes(x = SACTMIN, y = ride_name)) +
  geom_boxplot(na.rm = TRUE, outlier.shape = "circle", outlier.alpha = .1, size = 1) +
  coord_cartesian(xlim = c(0, 200)) +
  geom_vline(xintercept = c(30, 60, 90, 120), color = c("green", "yellow", "orange", "red"), size = 1)
```
# Compare Wait times for indoor and Splash Apect rides with Temp and precipitation levels

# Wait times for parades -- 

# Largest average wait times = busiest day of week -- Histogram of wait times highlight parade times
```{r}
if (FALSE) {
for (i in 1:14) {
  chart <- rides[[i]] %>%
    mutate(weekday = weekdays(datetime)) %>%
    group_by(weekday) %>%
    summarise(mean_wait = mean(SPOSTMIN, na.rm = TRUE)) %>%
    ggplot(aes(x = ordered(weekday, levels = days_of_week), y = mean_wait)) +
    geom_col() +
    coord_cartesian(ylim = c(0, 150)) +
    labs(title = names(rides[i]))
  print(chart)
}
}
```


```{r}
rides_df %>%
  mutate(weekday = weekdays(datetime)) %>%
  group_by(weekday, ride_name) %>%
  summarise(mean_wait = mean(SPOSTMIN, na.rm = TRUE)) %>%
  ggplot() +
  geom_col(aes(x = ordered(weekday, levels = days_of_week), y = mean_wait)) +
  theme(axis.text.x = element_text(angle = 90)) +
  facet_wrap(~ ride_name)
```


```{r}
rides_df %>%
  mutate(weekday = weekdays(datetime)) %>%
  group_by(weekday, ride_name) %>%
  summarise(mean_wait = mean(SPOSTMIN, na.rm = TRUE)) %>%
  ggplot(aes(x = ordered(weekday, levels = days_of_week), y = mean_wait, fill = ride_name)) +
  geom_col()
```


```{r}
rides_df %>%
  inner_join(ride_metadata) %>%
  mutate(weekday = weekdays(datetime)) %>%
  group_by(weekday, park) %>%
  summarise(mean_wait = mean(SPOSTMIN, na.rm = TRUE)) %>%
  ggplot() +
  geom_col(aes(x = ordered(weekday, levels = days_of_week), y = mean_wait, fill = park))
```

> Ask Dr Sanchez about improving this. Different parks have different amounts of rides

```{r}
rides_df %>%
  inner_join(ride_metadata) %>%
  mutate(weekday = weekdays(datetime)) %>%
  group_by(ride_name, park) %>%
  summarise(mean_wait = mean(SPOSTMIN, na.rm = TRUE)) %>%
  ggplot() +
  geom_col(aes(x = park, y = mean_wait, fill = ride_name))
```


```{r}
rides_df %>%
  mutate(year = year(as.POSIXct(mdy(date) + 1)), month = month(as.POSIXct(mdy(date) + 1)), day = weekdays(as.POSIXct(mdy(date) + 1)),
         monthweek = ceiling(day(mdy(date)) / 7)) %>%
  group_by(month, day, monthweek) %>%
  summarise(mean_wait = mean(SPOSTMIN, na.rm = TRUE)) %>% 
  ggplot(aes(x = monthweek, y = day, fill = mean_wait)) +
  geom_tile(color = "grey") +
  facet_grid(~month) +
  scale_fill_gradient2(low = "blue", mid = "orange", high = "red", midpoint = 60) +
  labs(fill = "Wait Time", title = "Mean wait time by day for all rides")
```

